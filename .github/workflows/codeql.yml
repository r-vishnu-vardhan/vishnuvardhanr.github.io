name: build workflow

on:
  push:
    branches:
      - '**'
  pull_request:
    types: [ opened, synchronize, reopened ]
jobs:
  check-code:
    runs-on: ubuntu-latest
    name: Build
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: 11
          distribution: "zulu"

      - name: Find changed projects
        id: find-projects
        run: |
          git fetch origin
          echo "::set-output name=file_names::$(find . -type f -name '*component*' -exec basename {} \;) are changed files"
          CHANGED_PROJECTS=$(git diff --name-only origin/main | grep -E 'src'| grep -E 'vishnuvardhanr.github.io' | cut -d'/' -f-3 | uniq)
          echo "Truncated Project list$CHANGED_PROJECTS"
          echo " LOG BREAK"
          projects=()
          for var in $CHANGED_PROJECTS; do
            projects+=($var)
          done
          echo "::set-output name=projects::${projects[@]}"

      - name: Setup Maven Action
        uses: s4u/setup-maven-action@v1.2.1
        with:
          java-version: 11
